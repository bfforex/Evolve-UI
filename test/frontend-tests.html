<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evolve-UI Frontend Test Suite</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
        }

        .test-section {
            padding: 20px;
            border-bottom: 1px solid #eee;
        }

        .test-section:last-child {
            border-bottom: none;
        }

        .test-section h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .test-card {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 15px;
        }

        .test-card h3 {
            color: #495057;
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .test-card p {
            color: #6c757d;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            margin: 5px 5px 5px 0;
        }

        .test-button:hover {
            background: #0056b3;
        }

        .test-button.success {
            background: #28a745;
        }

        .test-button.error {
            background: #dc3545;
        }

        .test-button.warning {
            background: #ffc107;
            color: #212529;
        }

        .test-result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            font-size: 0.9rem;
        }

        .test-result.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .test-result.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .test-result.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .manual-test {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 6px;
            padding: 15px;
            margin: 10px 0;
        }

        .manual-test h4 {
            color: #856404;
            margin-bottom: 8px;
        }

        .manual-test ol {
            color: #856404;
            margin-left: 20px;
        }

        .manual-test li {
            margin-bottom: 5px;
        }

        .results-summary {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            min-width: 200px;
            z-index: 1000;
        }

        .results-summary h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .results-summary .stat {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .iframe-container {
            width: 100%;
            height: 400px;
            border: 1px solid #ddd;
            border-radius: 6px;
            margin: 10px 0;
            overflow: hidden;
        }

        .iframe-container iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        @media (max-width: 768px) {
            .results-summary {
                position: static;
                margin-bottom: 20px;
            }
            
            .test-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß™ Evolve-UI Frontend Test Suite</h1>
            <p>Comprehensive testing for all frontend functionality</p>
        </div>

        <div class="results-summary">
            <h3>üìä Test Results</h3>
            <div class="stat">
                <span>‚úÖ Passed:</span>
                <span id="passedCount">0</span>
            </div>
            <div class="stat">
                <span>‚ùå Failed:</span>
                <span id="failedCount">0</span>
            </div>
            <div class="stat">
                <span>üìã Total:</span>
                <span id="totalCount">0</span>
            </div>
        </div>

        <div class="test-section">
            <h2>üé® Theme & UI Tests</h2>
            <div class="test-grid">
                <div class="test-card">
                    <h3>Theme Switching</h3>
                    <p>Test dark/light theme toggle functionality</p>
                    <button class="test-button" onclick="testThemeSwitching()">Test Theme Toggle</button>
                    <div id="theme-result" class="test-result" style="display: none;"></div>
                </div>

                <div class="test-card">
                    <h3>Sidebar Functionality</h3>
                    <p>Test sidebar collapse/expand and mobile toggle</p>
                    <button class="test-button" onclick="testSidebarToggle()">Test Sidebar</button>
                    <div id="sidebar-result" class="test-result" style="display: none;"></div>
                </div>

                <div class="test-card">
                    <h3>Responsive Design</h3>
                    <p>Test mobile and desktop layout adaptations</p>
                    <button class="test-button" onclick="testResponsiveDesign()">Test Responsive</button>
                    <div id="responsive-result" class="test-result" style="display: none;"></div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>üí¨ Chat Interface Tests</h2>
            <div class="test-grid">
                <div class="test-card">
                    <h3>Message Input</h3>
                    <p>Test message input field and send functionality</p>
                    <button class="test-button" onclick="testMessageInput()">Test Input</button>
                    <div id="input-result" class="test-result" style="display: none;"></div>
                </div>

                <div class="test-card">
                    <h3>Auto-resize Textarea</h3>
                    <p>Test textarea auto-resize functionality</p>
                    <button class="test-button" onclick="testTextareaResize()">Test Resize</button>
                    <div id="textarea-result" class="test-result" style="display: none;"></div>
                </div>

                <div class="test-card">
                    <h3>Keyboard Shortcuts</h3>
                    <p>Test Enter to send, Ctrl+Enter for new line</p>
                    <button class="test-button" onclick="testKeyboardShortcuts()">Test Shortcuts</button>
                    <div id="shortcuts-result" class="test-result" style="display: none;"></div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>üìÇ Session Management Tests</h2>
            <div class="test-grid">
                <div class="test-card">
                    <h3>Session Creation</h3>
                    <p>Test new session creation and naming</p>
                    <button class="test-button" onclick="testSessionCreation()">Test Creation</button>
                    <div id="session-create-result" class="test-result" style="display: none;"></div>
                </div>

                <div class="test-card">
                    <h3>Session Switching</h3>
                    <p>Test switching between different sessions</p>
                    <button class="test-button" onclick="testSessionSwitching()">Test Switching</button>
                    <div id="session-switch-result" class="test-result" style="display: none;"></div>
                </div>

                <div class="test-card">
                    <h3>Session Export</h3>
                    <p>Test session export functionality</p>
                    <button class="test-button" onclick="testSessionExport()">Test Export</button>
                    <div id="session-export-result" class="test-result" style="display: none;"></div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>üìé File Upload Tests</h2>
            <div class="test-grid">
                <div class="test-card">
                    <h3>File Selection</h3>
                    <p>Test file input and selection interface</p>
                    <button class="test-button" onclick="testFileSelection()">Test Selection</button>
                    <div id="file-select-result" class="test-result" style="display: none;"></div>
                </div>

                <div class="test-card">
                    <h3>Drag & Drop</h3>
                    <p>Test drag and drop file upload</p>
                    <button class="test-button" onclick="testDragDrop()">Test Drag & Drop</button>
                    <div id="dragdrop-result" class="test-result" style="display: none;"></div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>‚öôÔ∏è Settings Panel Tests</h2>
            <div class="test-grid">
                <div class="test-card">
                    <h3>Settings Toggle</h3>
                    <p>Test settings panel open/close</p>
                    <button class="test-button" onclick="testSettingsPanel()">Test Settings</button>
                    <div id="settings-result" class="test-result" style="display: none;"></div>
                </div>

                <div class="test-card">
                    <h3>Model Selection</h3>
                    <p>Test model dropdown and selection</p>
                    <button class="test-button" onclick="testModelSelection()">Test Models</button>
                    <div id="models-result" class="test-result" style="display: none;"></div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>üîÑ Integration with Evolve-UI</h2>
            <p>Test the actual Evolve-UI interface in embedded mode:</p>
            <div class="iframe-container">
                <iframe src="http://localhost:8787" title="Evolve-UI Interface"></iframe>
            </div>
        </div>

        <div class="test-section">
            <h2>üìù Manual Testing Checklist</h2>
            
            <div class="manual-test">
                <h4>Complete Chat Flow Test</h4>
                <ol>
                    <li>Open Evolve-UI in the iframe above or new tab</li>
                    <li>Create a new session</li>
                    <li>Send a simple message</li>
                    <li>Verify AI response appears</li>
                    <li>Check thinking process visualization</li>
                    <li>Test a search query (e.g., "What's the weather today?")</li>
                    <li>Verify search results and sources</li>
                    <li>Test file upload functionality</li>
                    <li>Switch themes (dark/light)</li>
                    <li>Test mobile view by resizing browser</li>
                </ol>
            </div>

            <div class="manual-test">
                <h4>Error Handling Test</h4>
                <ol>
                    <li>Disconnect internet and try sending a message</li>
                    <li>Try uploading an invalid file type</li>
                    <li>Test with very long messages</li>
                    <li>Test rapid-fire message sending</li>
                    <li>Check error messages are user-friendly</li>
                </ol>
            </div>

            <div class="manual-test">
                <h4>Performance Test</h4>
                <ol>
                    <li>Open developer tools</li>
                    <li>Monitor network requests during chat</li>
                    <li>Check console for errors</li>
                    <li>Test with multiple concurrent sessions</li>
                    <li>Monitor memory usage over time</li>
                </ol>
            </div>
        </div>
    </div>

    <script>
        let testResults = {
            passed: 0,
            failed: 0,
            total: 0
        };

        function updateResults() {
            document.getElementById('passedCount').textContent = testResults.passed;
            document.getElementById('failedCount').textContent = testResults.failed;
            document.getElementById('totalCount').textContent = testResults.total;
        }

        function showResult(elementId, success, message) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = `test-result ${success ? 'success' : 'error'}`;
            element.textContent = message;
            
            testResults.total++;
            if (success) {
                testResults.passed++;
            } else {
                testResults.failed++;
            }
            updateResults();
        }

        function showInfo(elementId, message) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = 'test-result info';
            element.textContent = message;
        }

        // Test Functions
        function testThemeSwitching() {
            try {
                // Check if we're in an iframe context or can access parent
                const hasThemeButton = document.querySelector('[data-theme-toggle]') || 
                                     (window.parent && window.parent.document.querySelector('[data-theme-toggle]'));
                
                if (hasThemeButton) {
                    showResult('theme-result', true, '‚úÖ Theme toggle button found');
                } else {
                    showInfo('theme-result', '‚ÑπÔ∏è Test requires running on actual Evolve-UI interface');
                }
            } catch (error) {
                showResult('theme-result', false, `‚ùå Theme test failed: ${error.message}`);
            }
        }

        function testSidebarToggle() {
            try {
                // Simulate sidebar toggle test
                const viewportWidth = window.innerWidth;
                const isMobile = viewportWidth < 768;
                
                showResult('sidebar-result', true, 
                    `‚úÖ Viewport: ${viewportWidth}px, Mobile: ${isMobile ? 'Yes' : 'No'}`);
            } catch (error) {
                showResult('sidebar-result', false, `‚ùå Sidebar test failed: ${error.message}`);
            }
        }

        function testResponsiveDesign() {
            try {
                const viewportWidth = window.innerWidth;
                const viewportHeight = window.innerHeight;
                
                const isDesktop = viewportWidth >= 1024;
                const isTablet = viewportWidth >= 768 && viewportWidth < 1024;
                const isMobile = viewportWidth < 768;
                
                let deviceType = 'Desktop';
                if (isMobile) deviceType = 'Mobile';
                else if (isTablet) deviceType = 'Tablet';
                
                showResult('responsive-result', true, 
                    `‚úÖ Device: ${deviceType} (${viewportWidth}x${viewportHeight})`);
            } catch (error) {
                showResult('responsive-result', false, `‚ùå Responsive test failed: ${error.message}`);
            }
        }

        function testMessageInput() {
            try {
                // Check if message input exists
                const hasTextarea = document.querySelector('textarea') || 
                                  document.querySelector('input[type="text"]');
                
                if (hasTextarea) {
                    showResult('input-result', true, '‚úÖ Message input field found');
                } else {
                    showInfo('input-result', '‚ÑπÔ∏è Test requires Evolve-UI interface context');
                }
            } catch (error) {
                showResult('input-result', false, `‚ùå Input test failed: ${error.message}`);
            }
        }

        function testTextareaResize() {
            try {
                // Test if CSS supports textarea resize
                const testDiv = document.createElement('div');
                testDiv.style.resize = 'vertical';
                const supportsResize = testDiv.style.resize === 'vertical';
                
                showResult('textarea-result', supportsResize, 
                    supportsResize ? '‚úÖ Browser supports textarea resize' : '‚ùå Browser does not support resize');
            } catch (error) {
                showResult('textarea-result', false, `‚ùå Textarea test failed: ${error.message}`);
            }
        }

        function testKeyboardShortcuts() {
            try {
                // Test if we can detect key events
                let keyTestPassed = false;
                
                const testKeyEvent = () => {
                    keyTestPassed = true;
                    document.removeEventListener('keydown', testKeyEvent);
                    showResult('shortcuts-result', true, '‚úÖ Keyboard event detection working');
                };
                
                document.addEventListener('keydown', testKeyEvent);
                
                // Trigger a test key event
                const event = new KeyboardEvent('keydown', { key: 'Enter' });
                document.dispatchEvent(event);
                
                setTimeout(() => {
                    if (!keyTestPassed) {
                        showInfo('shortcuts-result', '‚ÑπÔ∏è Press any key to test keyboard detection');
                    }
                }, 1000);
                
            } catch (error) {
                showResult('shortcuts-result', false, `‚ùå Keyboard test failed: ${error.message}`);
            }
        }

        function testSessionCreation() {
            try {
                // Test local storage capabilities
                const testKey = 'evolve-ui-test';
                const testValue = 'session-test';
                
                localStorage.setItem(testKey, testValue);
                const retrieved = localStorage.getItem(testKey);
                localStorage.removeItem(testKey);
                
                const success = retrieved === testValue;
                showResult('session-create-result', success, 
                    success ? '‚úÖ Local storage working for sessions' : '‚ùå Local storage failed');
            } catch (error) {
                showResult('session-create-result', false, `‚ùå Session test failed: ${error.message}`);
            }
        }

        function testSessionSwitching() {
            try {
                // Test if we can make API calls
                fetch('/api/sessions')
                    .then(response => {
                        const success = response.status === 200;
                        showResult('session-switch-result', success, 
                            success ? '‚úÖ Sessions API accessible' : '‚ùå Sessions API not available');
                    })
                    .catch(error => {
                        showInfo('session-switch-result', '‚ÑπÔ∏è Sessions API not available (server not running)');
                    });
            } catch (error) {
                showResult('session-switch-result', false, `‚ùå Session switch test failed: ${error.message}`);
            }
        }

        function testSessionExport() {
            try {
                // Test if we can create and download files
                const testData = JSON.stringify({ test: 'export functionality' });
                const blob = new Blob([testData], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                // Test if URL was created successfully
                const success = url.startsWith('blob:');
                if (success) {
                    URL.revokeObjectURL(url);
                }
                
                showResult('session-export-result', success, 
                    success ? '‚úÖ File export functionality available' : '‚ùå File export not supported');
            } catch (error) {
                showResult('session-export-result', false, `‚ùå Export test failed: ${error.message}`);
            }
        }

        function testFileSelection() {
            try {
                // Test if File API is supported
                const supportsFileAPI = window.File && window.FileReader && window.FileList && window.Blob;
                
                showResult('file-select-result', supportsFileAPI, 
                    supportsFileAPI ? '‚úÖ File API supported' : '‚ùå File API not supported');
            } catch (error) {
                showResult('file-select-result', false, `‚ùå File selection test failed: ${error.message}`);
            }
        }

        function testDragDrop() {
            try {
                // Test if drag and drop is supported
                const supportsDragDrop = 'draggable' in document.createElement('div') &&
                                        'ondrop' in window &&
                                        'ondragstart' in window;
                
                showResult('dragdrop-result', supportsDragDrop, 
                    supportsDragDrop ? '‚úÖ Drag & drop supported' : '‚ùå Drag & drop not supported');
            } catch (error) {
                showResult('dragdrop-result', false, `‚ùå Drag & drop test failed: ${error.message}`);
            }
        }

        function testSettingsPanel() {
            try {
                // Test if we can detect modal/panel functionality
                const supportsModal = 'showModal' in document.createElement('dialog');
                
                showResult('settings-result', true, 
                    `‚úÖ Modal support: ${supportsModal ? 'Yes' : 'Fallback available'}`);
            } catch (error) {
                showResult('settings-result', false, `‚ùå Settings test failed: ${error.message}`);
            }
        }

        function testModelSelection() {
            try {
                // Test if we can access models API
                fetch('/api/models')
                    .then(response => {
                        showResult('models-result', response.ok, 
                            response.ok ? '‚úÖ Models API accessible' : '‚ùå Models API not available');
                    })
                    .catch(error => {
                        showInfo('models-result', '‚ÑπÔ∏è Models API not available (Ollama not running)');
                    });
            } catch (error) {
                showResult('models-result', false, `‚ùå Models test failed: ${error.message}`);
            }
        }

        // Auto-run basic compatibility tests on load
        window.addEventListener('load', function() {
            setTimeout(() => {
                console.log('üß™ Frontend Test Suite Loaded');
                console.log('Click test buttons to run individual tests');
                console.log('Or use the embedded Evolve-UI for integration testing');
            }, 1000);
        });

        // Test if Evolve-UI is accessible
        window.addEventListener('load', function() {
            const iframe = document.querySelector('iframe');
            if (iframe) {
                iframe.onload = function() {
                    console.log('‚úÖ Evolve-UI loaded in iframe');
                };
                iframe.onerror = function() {
                    console.log('‚ùå Could not load Evolve-UI in iframe - server may not be running');
                };
            }
        });
    </script>
</body>
</html>